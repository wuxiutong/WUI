"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("vue"),m=require("./tree-node.vue.js"),C=require("./type.js"),I=require("../utils/random.js"),D=["id"],O={key:0,class:"z-tree-empty-tips"},T=r.defineComponent({name:"wui-tree",__name:"tree",props:{data:{default:()=>[]},checkedKeys:{default:()=>[]},expandKeys:{default:()=>[]},emptyTips:{default:"无数据"},cascade:{type:Boolean,default:!0},showCheckbox:{type:Boolean,default:!1},transition:{default:"slide-fade"},showLine:{type:Boolean,default:!0},expandAll:{type:Boolean,default:!1},checkedAll:{type:Boolean,default:!1},multipleCheck:{type:Boolean,default:!0},onlyLeafCheck:{type:Boolean,default:!0},enableDblclick:{type:Boolean,default:!1},enableWholeAnchorStatus:{type:Boolean,default:!1},enableCheckConfirm:{type:Boolean,default:!1},showId:{type:Boolean,default:!1},idSeparator:{default:""},hideLeafIcon:{type:Boolean,default:!1},hideExpander:{type:Boolean,default:!1},nodeContentClickAction:{default:C.TreeNodeContentClickActionEnum.NONE},senderElementId:{default:""},treeId:{default:()=>I.randomString(32)},focusedId:{}},emits:["update:checkedKeys","tree-node-click","tree-node-checkbox-click"],setup(A,{emit:N}){const f=N,a=A;let s=r.reactive([]);const h=r.ref([]),c=r.ref([]),u=r.ref([]);r.watch(()=>a.data,()=>{b()},{deep:!0}),r.watch(()=>a.checkedKeys,()=>{_()},{deep:!0}),r.watch(()=>a.focusedId,()=>{S()}),r.watch(()=>a.showCheckbox,()=>{_()}),r.watch(()=>a.expandAll,()=>{h.value.forEach(e=>{e.expanded=a.expandAll})}),r.watch(()=>a.checkedAll,()=>{if(a.checkedAll){c.value.forEach(n=>{n.checked=0}),c.value.splice(0,c.value.length);const l=h.value.filter(n=>!n.disabled);l&&l.length>0&&l.forEach(n=>{c.value.push(n),n.checked=1})}else c.value.forEach(l=>{l.checked=0}),c.value.splice(0,c.value.length);let e=[];c.value.forEach(l=>{e.push({id:l.id,label:l.label})}),f("update:checkedKeys",e)}),r.watch(()=>a.expandKeys,()=>{L()},{deep:!0});function y(e,l,n){l&&e.forEach(t=>{let i={label:t.label,id:t.id,tabIndex:n.index++,children:[],checked:0,disabled:t.disabled,expanded:!1,__parent:l};a.checkedKeys.filter(d=>i.id===d.id).length>0&&c.value.push(i),a.expandKeys.filter(d=>i.id===d.id).length>0&&u.value.push(i),l.children===void 0&&(l.children=[]),l.children.push(i),h.value.push(i),t.children&&t.children.length&&y(t.children,i,n)})}function b(){s.splice(0,s.length),c.value.splice(0,c.value.length),u.value.splice(0,u.value.length),h.value=[];let e={index:1};a.data.forEach(l=>{let n={label:l.label,tabIndex:e.index++,id:l.id,children:[],checked:0,disabled:l.disabled,expanded:!1,__parent:null};a.checkedKeys.filter(t=>n.id===t.id).length>0&&c.value.push(n),a.expandKeys.filter(t=>n.id===t.id).length>0&&u.value.push(n),l.children&&l.children.length&&y(l.children,n,e),s.push(n),h.value.push(n)}),c.value.forEach(l=>{l.checked=1,a.cascade&&(l.children&&l.children.length>0&&o(l,1),l.__parent&&p(l,1))}),u.value.forEach(l=>{l.children&&l.children.length>0&&(l.expanded=!0,l.__parent&&v(l.__parent,!0))}),(!u.value||u.value.length<=0)&&h.value.forEach(l=>{l.expanded=a.expandAll})}function v(e,l){e.expanded=l,e.__parent&&v(e.__parent,l)}function _(){let e=a.checkedKeys.length!==c.value.length;e||a.checkedKeys.some(l=>{let n=!1;if(h.value.some(t=>{if(t.id===l.id)return n=!0,!0}),!n)return e=!0,!0}),e||h.value.some(l=>{let n=!1;if(a.checkedKeys.some(t=>{if(t.id===l.id)return n=!0,!0}),!n)return e=!0,!0}),e&&(c.value.splice(0,c.value.length),a.checkedKeys.forEach(l=>{h.value.some(n=>{if(n.id===l.id)return c.value.push(n),!0})}),c.value.forEach(l=>{l.checked=1,a.multipleCheck&&a.cascade&&(l.children&&l.children.length>0&&o(l,1),l.__parent&&p(l,1))}))}function L(){u.value=[],a.expandKeys.forEach(e=>{h.value.some(l=>{if(l.id===e.id)return u.value.push(l),!0})}),u.value.forEach(e=>{e.children&&e.children.length>0&&(e.expanded=!0,e.__parent&&v(e.__parent,!0))})}function B(e,l){if(a.nodeContentClickAction===C.TreeNodeContentClickActionEnum.NONE)f("tree-node-click",e,l);else{if(a.nodeContentClickAction===C.TreeNodeContentClickActionEnum.CHECK)return a.onlyLeafCheck&&e.children&&e.children.length>0?(e.expanded=!e.expanded,f("tree-node-click",e,l),!1):(e.disabled||g(e,l),!1);a.nodeContentClickAction===C.TreeNodeContentClickActionEnum.EXPAND&&(e.expanded=!e.expanded),f("tree-node-click",e,l)}}function w(e){if(a.enableDblclick){if(a.onlyLeafCheck&&e.children&&e.children.length>0)return!1;for(let n=0;n<c.value.length;n++)c.value[n].id!==e.id&&(c.value[n].checked=0,c.value.splice(n,1),n--);c.value.indexOf(e)<=-1&&(e.checked=1,c.value.push(e))}}function g(e,l){e.disabled||(a.enableCheckConfirm?f("tree-node-checkbox-click",e,()=>x(e),l):(f("tree-node-checkbox-click",e,()=>{},l),x(e)))}function x(e){return new Promise((l,n)=>{try{if(e.checked!==1)if(a.multipleCheck){let i=!1;c.value.some(d=>{if(d.id===e.id)return i=!0,!0}),i||(!a.onlyLeafCheck||a.onlyLeafCheck&&(!e.children||e.children.length<=0))&&c.value.push(e),a.cascade?(e.checked=1,a.multipleCheck&&(e.children&&e.children.length>0&&o(e,e.checked),e.__parent&&p(e,e.checked))):(!a.onlyLeafCheck||a.onlyLeafCheck&&(!e.children||e.children.length<=0))&&(e.checked=1)}else{if(a.onlyLeafCheck&&e.children&&e.children.length>0)return!1;for(let i=0;i<c.value.length;i++)c.value[i].id!==e.id&&(c.value[i].checked=0,c.value.splice(i,1),i--);c.value.length<=0&&(e.checked=1,(!a.onlyLeafCheck||a.onlyLeafCheck&&(!e.children||e.children.length<=0))&&c.value.push(e))}else c.value.some(i=>{if(i.id===e.id)return i.checked=0,c.value.splice(c.value.indexOf(i),1),!0}),e.checked=0,a.cascade&&a.multipleCheck&&(e.children&&e.children.length>0&&o(e,e.checked),e.__parent&&p(e,e.checked));let t=[];c.value.forEach(i=>{t.push({id:i.id,label:i.label})}),f("update:checkedKeys",t),l(t)}catch(t){n(t)}})}function K(e){const l=u.value.indexOf(e);e.expanded?(e.expanded=!1,l>-1&&u.value.splice(l,1)):(e.expanded=!0,l<=-1&&u.value.push(e))}function o(e,l){e.children&&e.children.length&&e.children.forEach(n=>{if(n.checked!==l){n.checked=l;const t=c.value.indexOf(n);l===1?(!a.onlyLeafCheck||a.onlyLeafCheck&&(!n.children||n.children.length<=0))&&t<=-1&&c.value.push(n):t>-1&&c.value.splice(t,1),n.children&&n.children.length>0&&o(n,l)}})}function p(e,l){var n,t;if(e.__parent){const i=e.__parent.checked;if(l===0){let d=0;(n=e.__parent.children)==null||n.some(k=>{if(k.checked===1||k.checked===2)return d=2,!0}),e.__parent.checked=d}else if(l===1){let d=1;(t=e.__parent.children)==null||t.some(k=>{if(k.checked===0||k.checked===2)return d=2,!0}),e.__parent.checked=d}else e.__parent.checked=2;if(e.__parent.checked!==1){const d=c.value.indexOf(e.__parent);d>-1&&c.value.splice(d,1)}else a.onlyLeafCheck||c.value.indexOf(e.__parent)<=-1&&c.value.push(e.__parent);i!==e.__parent.checked&&p(e.__parent,l)}}function S(){if(a.focusedId){let e=!1;if(h.value.some(l=>{if(String(l.id)===String(a.focusedId)){e=!0;const n=document.getElementById(a.treeId+"__"+l.tabIndex);return n?n.focus():(E(l),setTimeout(()=>{const t=document.getElementById(a.treeId+"__"+l.tabIndex);if(t)t.focus();else{const i=document.getElementById(a.treeId+"__1");i&&i.focus()}},100)),!0}}),!e){const l=document.getElementById(a.treeId+"__1");l&&l.focus()}}}function E(e){e.__parent&&(e.__parent.expanded=!0,E(e.__parent))}return b(),(e,l)=>(r.openBlock(),r.createElementBlock("div",{class:"z-tree",id:e.treeId},[!r.unref(s)||r.unref(s).length<=0?(r.openBlock(),r.createElementBlock("div",O,[r.createElementVNode("span",null,r.toDisplayString(e.emptyTips),1)])):(r.openBlock(!0),r.createElementBlock(r.Fragment,{key:1},r.renderList(r.unref(s),(n,t)=>(r.openBlock(),r.createBlock(r.unref(m.default),{"sender-element-id":e.senderElementId,"tree-id":e.treeId,"tree-node-list":h.value,"max-tab-index":h.value.length+1,key:n.id?n.id:t,treeNode:n,cascade:e.cascade,showCheckbox:e.showCheckbox,transition:e.transition,showLine:e.showLine,expandAll:e.expandAll,checkedAll:e.checkedAll,multipleCheck:e.multipleCheck,onlyLeafCheck:e.onlyLeafCheck,enableDblclick:e.enableDblclick,enableWholeAnchorStatus:e.enableWholeAnchorStatus,enableCheckConfirm:e.enableCheckConfirm,showId:e.showId,idSeparator:e.idSeparator,hideLeafIcon:e.hideLeafIcon,hideExpander:e.hideExpander,nodeContentClickAction:e.nodeContentClickAction,checkedNodes:c.value,expandKeys:e.expandKeys,onCheckboxClick:g,"onUpdate:expandNode":K,onNodeClick:B,onNodeDblclick:w},{default:r.withCtx(i=>[r.renderSlot(e.$slots,"default",{treeNode:i.treeNode})]),_:2},1032,["sender-element-id","tree-id","tree-node-list","max-tab-index","treeNode","cascade","showCheckbox","transition","showLine","expandAll","checkedAll","multipleCheck","onlyLeafCheck","enableDblclick","enableWholeAnchorStatus","enableCheckConfirm","showId","idSeparator","hideLeafIcon","hideExpander","nodeContentClickAction","checkedNodes","expandKeys"]))),128))],8,D))}});exports.default=T;
