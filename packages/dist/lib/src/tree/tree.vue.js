"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const i=require("vue"),S=require("./tree-node.vue.js"),C=require("./type.js"),D=require("../utils/random.js"),O={key:0,class:"z-tree-empty-tips"},T=i.defineComponent({name:"wui-tree",__name:"tree",props:{data:{default:()=>[]},checkedKeys:{default:()=>[]},expandKeys:{default:()=>[]},emptyTips:{default:"无数据"},cascade:{type:Boolean,default:!0},showCheckbox:{type:Boolean,default:!1},transition:{default:"slide-fade"},showLine:{type:Boolean,default:!0},expandAll:{type:Boolean,default:!1},checkedAll:{type:Boolean,default:!1},multipleCheck:{type:Boolean,default:!0},onlyLeafCheck:{type:Boolean,default:!0},enableDblclick:{type:Boolean,default:!1},enableWholeAnchorStatus:{type:Boolean,default:!1},enableCheckConfirm:{type:Boolean,default:!1},showId:{type:Boolean,default:!1},idSeparator:{default:""},hideLeafIcon:{type:Boolean,default:!1},hideExpander:{type:Boolean,default:!1},nodeContentClickAction:{default:C.TreeNodeContentClickActionEnum.NONE},senderElementId:{default:""},treeId:{default:()=>D.randomString(32)}},emits:["update:checkedKeys","tree-node-click","tree-node-checkbox-click"],setup(A,{emit:N}){const f=N,n=A;let s=i.reactive([]);const u=i.ref([]),c=i.ref([]),h=i.ref([]);i.watch(()=>n.data,()=>{b()},{deep:!0}),i.watch(()=>n.checkedKeys,()=>{g()},{deep:!0}),i.watch(()=>n.showCheckbox,()=>{g()}),i.watch(()=>n.expandAll,()=>{u.value.forEach(e=>{e.expanded=n.expandAll})}),i.watch(()=>n.checkedAll,()=>{if(n.checkedAll){c.value.forEach(a=>{a.checked=0}),c.value.splice(0,c.value.length);const l=u.value.filter(a=>!a.disabled);l&&l.length>0&&l.forEach(a=>{c.value.push(a),a.checked=1})}else c.value.forEach(l=>{l.checked=0}),c.value.splice(0,c.value.length);let e=[];c.value.forEach(l=>{e.push({id:l.id,label:l.label})}),f("update:checkedKeys",e)}),i.watch(()=>n.expandKeys,()=>{L()},{deep:!0});function y(e,l,a){l&&e.forEach(t=>{let r={label:t.label,id:t.id,tabIndex:a.index++,children:[],checked:0,disabled:t.disabled,expanded:!1,parent:l};n.checkedKeys.filter(d=>r.id===d.id).length>0&&c.value.push(r),n.expandKeys.filter(d=>r.id===d.id).length>0&&h.value.push(r),l.children===void 0&&(l.children=[]),l.children.push(r),u.value.push(r),t.children&&t.children.length&&y(t.children,r,a)})}function b(){s.splice(0,s.length),c.value.splice(0,c.value.length),h.value.splice(0,h.value.length),u.value=[];let e={index:1};n.data.forEach(l=>{let a={label:l.label,tabIndex:e.index++,id:l.id,children:[],checked:0,disabled:l.disabled,expanded:!1,parent:null};n.checkedKeys.filter(t=>a.id===t.id).length>0&&c.value.push(a),n.expandKeys.filter(t=>a.id===t.id).length>0&&h.value.push(a),l.children&&l.children.length&&y(l.children,a,e),s.push(a),u.value.push(a)}),c.value.forEach(l=>{l.checked=1,n.cascade&&(l.children&&l.children.length>0&&o(l,1),l.parent&&p(l,1))}),h.value.forEach(l=>{l.children&&l.children.length>0&&(l.expanded=!0,l.parent&&v(l.parent,!0))}),(!h.value||h.value.length<=0)&&u.value.forEach(l=>{l.expanded=n.expandAll})}function v(e,l){e.expanded=l,e.parent&&v(e.parent,l)}function g(){let e=n.checkedKeys.length!==c.value.length;e||n.checkedKeys.some(l=>{let a=!1;if(u.value.some(t=>{if(t.id===l.id)return a=!0,!0}),!a)return e=!0,!0}),e||u.value.some(l=>{let a=!1;if(n.checkedKeys.some(t=>{if(t.id===l.id)return a=!0,!0}),!a)return e=!0,!0}),e&&(c.value.splice(0,c.value.length),n.checkedKeys.forEach(l=>{u.value.some(a=>{if(a.id===l.id)return c.value.push(a),!0})}),c.value.forEach(l=>{l.checked=1,n.multipleCheck&&n.cascade&&(l.children&&l.children.length>0&&o(l,1),l.parent&&p(l,1))}))}function L(){h.value=[],n.expandKeys.forEach(e=>{u.value.some(l=>{if(l.id===e.id)return h.value.push(l),!0})}),h.value.forEach(e=>{e.children&&e.children.length>0&&(e.expanded=!0,e.parent&&v(e.parent,!0))})}function w(e,l){if(n.nodeContentClickAction===C.TreeNodeContentClickActionEnum.NONE)f("tree-node-click",e,l);else{if(n.nodeContentClickAction===C.TreeNodeContentClickActionEnum.CHECK)return n.onlyLeafCheck&&e.children&&e.children.length>0?(e.expanded=!e.expanded,f("tree-node-click",e,l),!1):(e.disabled||x(e,l),!1);n.nodeContentClickAction===C.TreeNodeContentClickActionEnum.EXPAND&&(e.expanded=!e.expanded),f("tree-node-click",e,l)}}function K(e){if(n.enableDblclick){if(n.onlyLeafCheck&&e.children&&e.children.length>0)return!1;for(let a=0;a<c.value.length;a++)c.value[a].id!==e.id&&(c.value[a].checked=0,c.value.splice(a,1),a--);c.value.indexOf(e)<=-1&&(e.checked=1,c.value.push(e))}}function x(e,l){e.disabled||(n.enableCheckConfirm?f("tree-node-checkbox-click",e,()=>E(e),l):(f("tree-node-checkbox-click",e,()=>{},l),E(e)))}function E(e){return new Promise((l,a)=>{try{if(e.checked!==1)if(n.multipleCheck){let r=!1;c.value.some(d=>{if(d.id===e.id)return r=!0,!0}),r||(!n.onlyLeafCheck||n.onlyLeafCheck&&(!e.children||e.children.length<=0))&&c.value.push(e),n.cascade?(e.checked=1,n.multipleCheck&&(e.children&&e.children.length>0&&o(e,e.checked),e.parent&&p(e,e.checked))):(!n.onlyLeafCheck||n.onlyLeafCheck&&(!e.children||e.children.length<=0))&&(e.checked=1)}else{if(n.onlyLeafCheck&&e.children&&e.children.length>0)return!1;for(let r=0;r<c.value.length;r++)c.value[r].id!==e.id&&(c.value[r].checked=0,c.value.splice(r,1),r--);c.value.length<=0&&(e.checked=1,(!n.onlyLeafCheck||n.onlyLeafCheck&&(!e.children||e.children.length<=0))&&c.value.push(e))}else c.value.some(r=>{if(r.id===e.id)return r.checked=0,c.value.splice(c.value.indexOf(r),1),!0}),e.checked=0,n.cascade&&n.multipleCheck&&(e.children&&e.children.length>0&&o(e,e.checked),e.parent&&p(e,e.checked));let t=[];c.value.forEach(r=>{t.push({id:r.id,label:r.label})}),f("update:checkedKeys",t),l(t)}catch(t){a(t)}})}function B(e){const l=h.value.indexOf(e);e.expanded?(e.expanded=!1,l>-1&&h.value.splice(l,1)):(e.expanded=!0,l<=-1&&h.value.push(e))}function o(e,l){e.children&&e.children.length&&e.children.forEach(a=>{if(a.checked!==l){a.checked=l;const t=c.value.indexOf(a);l===1?(!n.onlyLeafCheck||n.onlyLeafCheck&&(!a.children||a.children.length<=0))&&t<=-1&&c.value.push(a):t>-1&&c.value.splice(t,1),a.children&&a.children.length>0&&o(a,l)}})}function p(e,l){var a,t;if(e.parent){const r=e.parent.checked;if(l===0){let d=0;(a=e.parent.children)==null||a.some(k=>{if(k.checked===1||k.checked===2)return d=2,!0}),e.parent.checked=d}else if(l===1){let d=1;(t=e.parent.children)==null||t.some(k=>{if(k.checked===0||k.checked===2)return d=2,!0}),e.parent.checked=d}else e.parent.checked=2;if(e.parent.checked!==1){const d=c.value.indexOf(e.parent);d>-1&&c.value.splice(d,1)}else n.onlyLeafCheck||c.value.indexOf(e.parent)<=-1&&c.value.push(e.parent);r!==e.parent.checked&&p(e.parent,l)}}return b(),(e,l)=>(i.openBlock(),i.createElementBlock("div",{class:i.normalizeClass(["z-tree",e.treeId])},[!i.unref(s)||i.unref(s).length<=0?(i.openBlock(),i.createElementBlock("div",O,[i.createElementVNode("span",null,i.toDisplayString(e.emptyTips),1)])):(i.openBlock(!0),i.createElementBlock(i.Fragment,{key:1},i.renderList(i.unref(s),(a,t)=>(i.openBlock(),i.createBlock(i.unref(S.default),{"sender-element-id":e.senderElementId,"tree-id":e.treeId,"max-tab-index":u.value.length+1,key:a.id?a.id:t,treeNode:a,cascade:e.cascade,showCheckbox:e.showCheckbox,transition:e.transition,showLine:e.showLine,expandAll:e.expandAll,checkedAll:e.checkedAll,multipleCheck:e.multipleCheck,onlyLeafCheck:e.onlyLeafCheck,enableDblclick:e.enableDblclick,enableWholeAnchorStatus:e.enableWholeAnchorStatus,enableCheckConfirm:e.enableCheckConfirm,showId:e.showId,idSeparator:e.idSeparator,hideLeafIcon:e.hideLeafIcon,hideExpander:e.hideExpander,nodeContentClickAction:e.nodeContentClickAction,checkedNodes:c.value,expandKeys:e.expandKeys,onCheckboxClick:x,"onUpdate:expandNode":B,onNodeClick:w,onNodeDblclick:K},{default:i.withCtx(r=>[i.renderSlot(e.$slots,"default",{treeNode:r.treeNode})]),_:2},1032,["sender-element-id","tree-id","max-tab-index","treeNode","cascade","showCheckbox","transition","showLine","expandAll","checkedAll","multipleCheck","onlyLeafCheck","enableDblclick","enableWholeAnchorStatus","enableCheckConfirm","showId","idSeparator","hideLeafIcon","hideExpander","nodeContentClickAction","checkedNodes","expandKeys"]))),128))],2))}});exports.default=T;
