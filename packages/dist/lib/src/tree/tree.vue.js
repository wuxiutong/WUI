"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const i=require("vue"),S=require("./tree-node.vue.js"),C=require("./type.js"),D={class:"z-tree"},O={key:0,class:"z-tree-empty-tips"},T=i.defineComponent({name:"wui-tree",__name:"tree",props:{data:{default:()=>[]},checkedKeys:{default:()=>[]},expandKeys:{default:()=>[]},emptyTips:{default:"无数据"},cascade:{type:Boolean,default:!0},showCheckbox:{type:Boolean,default:!1},transition:{default:"slide-fade"},showLine:{type:Boolean,default:!0},expandAll:{type:Boolean,default:!1},checkedAll:{type:Boolean,default:!1},multipleCheck:{type:Boolean,default:!0},onlyLeafCheck:{type:Boolean,default:!0},enableDblclick:{type:Boolean,default:!1},enableWholeAnchorStatus:{type:Boolean,default:!1},enableCheckConfirm:{type:Boolean,default:!1},showId:{type:Boolean,default:!1},idSeparator:{default:""},hideLeafIcon:{type:Boolean,default:!1},hideExpander:{type:Boolean,default:!1},nodeContentClickAction:{default:C.TreeNodeContentClickActionEnum.NONE}},emits:["update:checkedKeys","tree-node-click","tree-node-checkbox-click"],setup(A,{emit:N}){const f=N,n=A;let s=i.reactive([]);const u=i.ref([]),a=i.ref([]),h=i.ref([]);i.watch(()=>n.data,()=>{b()},{deep:!0}),i.watch(()=>n.checkedKeys,()=>{g()},{deep:!0}),i.watch(()=>n.showCheckbox,()=>{g()}),i.watch(()=>n.expandAll,()=>{u.value.forEach(e=>{e.expanded=n.expandAll})}),i.watch(()=>n.checkedAll,()=>{if(n.checkedAll){a.value.forEach(c=>{c.checked=0}),a.value.splice(0,a.value.length);const l=u.value.filter(c=>!c.disabled);l&&l.length>0&&l.forEach(c=>{a.value.push(c),c.checked=1})}else a.value.forEach(l=>{l.checked=0}),a.value.splice(0,a.value.length);let e=[];a.value.forEach(l=>{e.push({id:l.id,label:l.label})}),f("update:checkedKeys",e)}),i.watch(()=>n.expandKeys,()=>{L()},{deep:!0});function y(e,l){l&&e.forEach(c=>{let t={label:c.label,id:c.id,children:[],checked:0,disabled:c.disabled,expanded:!1,parent:l};n.checkedKeys.filter(r=>t.id===r.id).length>0&&a.value.push(t),n.expandKeys.filter(r=>t.id===r.id).length>0&&h.value.push(t),l.children===void 0&&(l.children=[]),l.children.push(t),u.value.push(t),c.children&&c.children.length&&y(c.children,t)})}function b(){s.splice(0,s.length),a.value.splice(0,a.value.length),h.value.splice(0,h.value.length),u.value=[],n.data.forEach(e=>{let l={label:e.label,id:e.id,children:[],checked:0,disabled:e.disabled,expanded:!1,parent:null};n.checkedKeys.filter(c=>l.id===c.id).length>0&&a.value.push(l),n.expandKeys.filter(c=>l.id===c.id).length>0&&h.value.push(l),e.children&&e.children.length&&y(e.children,l),s.push(l),u.value.push(l)}),a.value.forEach(e=>{e.checked=1,n.cascade&&(e.children&&e.children.length>0&&o(e,1),e.parent&&p(e,1))}),h.value.forEach(e=>{e.children&&e.children.length>0&&(e.expanded=!0,e.parent&&v(e.parent,!0))})}function v(e,l){e.expanded=l,e.parent&&v(e.parent,l)}function g(){let e=n.checkedKeys.length!==a.value.length;e||n.checkedKeys.some(l=>{let c=!1;if(u.value.some(t=>{if(t.id===l.id)return c=!0,!0}),!c)return e=!0,!0}),e||u.value.some(l=>{let c=!1;if(n.checkedKeys.some(t=>{if(t.id===l.id)return c=!0,!0}),!c)return e=!0,!0}),e&&(a.value.splice(0,a.value.length),n.checkedKeys.forEach(l=>{u.value.some(c=>{if(c.id===l.id)return a.value.push(c),!0})}),a.value.forEach(l=>{l.checked=1,n.multipleCheck&&n.cascade&&(l.children&&l.children.length>0&&o(l,1),l.parent&&p(l,1))}))}function L(){h.value=[],n.expandKeys.forEach(e=>{u.value.some(l=>{if(l.id===e.id)return h.value.push(l),!0})}),h.value.forEach(e=>{e.children&&e.children.length>0&&(e.expanded=!0,e.parent&&v(e.parent,!0))})}function w(e,l){if(n.nodeContentClickAction===C.TreeNodeContentClickActionEnum.NONE)f("tree-node-click",e,l);else{if(n.nodeContentClickAction===C.TreeNodeContentClickActionEnum.CHECK)return n.onlyLeafCheck&&e.children&&e.children.length>0?(e.expanded=!e.expanded,f("tree-node-click",e,l),!1):(e.disabled||E(e,l),!1);n.nodeContentClickAction===C.TreeNodeContentClickActionEnum.EXPAND&&(e.expanded=!e.expanded),f("tree-node-click",e,l)}}function K(e){if(n.enableDblclick){if(n.onlyLeafCheck&&e.children&&e.children.length>0)return!1;for(let c=0;c<a.value.length;c++)a.value[c].id!==e.id&&(a.value[c].checked=0,a.value.splice(c,1),c--);a.value.indexOf(e)<=-1&&(e.checked=1,a.value.push(e))}}function E(e,l){e.disabled||(n.enableCheckConfirm?f("tree-node-checkbox-click",e,()=>x(e),l):(f("tree-node-checkbox-click",e,()=>{},l),x(e)))}function x(e){return new Promise((l,c)=>{try{if(e.checked!==1)if(n.multipleCheck){let r=!1;a.value.some(d=>{if(d.id===e.id)return r=!0,!0}),r||(!n.onlyLeafCheck||n.onlyLeafCheck&&(!e.children||e.children.length<=0))&&a.value.push(e),n.cascade?(e.checked=1,n.multipleCheck&&(e.children&&e.children.length>0&&o(e,e.checked),e.parent&&p(e,e.checked))):(!n.onlyLeafCheck||n.onlyLeafCheck&&(!e.children||e.children.length<=0))&&(e.checked=1)}else{if(n.onlyLeafCheck&&e.children&&e.children.length>0)return!1;for(let r=0;r<a.value.length;r++)a.value[r].id!==e.id&&(a.value[r].checked=0,a.value.splice(r,1),r--);a.value.length<=0&&(e.checked=1,(!n.onlyLeafCheck||n.onlyLeafCheck&&(!e.children||e.children.length<=0))&&a.value.push(e))}else a.value.some(r=>{if(r.id===e.id)return r.checked=0,a.value.splice(a.value.indexOf(r),1),!0}),e.checked=0,n.cascade&&n.multipleCheck&&(e.children&&e.children.length>0&&o(e,e.checked),e.parent&&p(e,e.checked));let t=[];a.value.forEach(r=>{t.push({id:r.id,label:r.label})}),f("update:checkedKeys",t),l(t)}catch(t){c(t)}})}function B(e){const l=h.value.indexOf(e);e.expanded?(e.expanded=!1,l>-1&&h.value.splice(l,1)):(e.expanded=!0,l<=-1&&h.value.push(e))}function o(e,l){e.children&&e.children.length&&e.children.forEach(c=>{if(c.checked!==l){c.checked=l;const t=a.value.indexOf(c);l===1?(!n.onlyLeafCheck||n.onlyLeafCheck&&(!c.children||c.children.length<=0))&&t<=-1&&a.value.push(c):t>-1&&a.value.splice(t,1),c.children&&c.children.length>0&&o(c,l)}})}function p(e,l){var c,t;if(e.parent){const r=e.parent.checked;if(l===0){let d=0;(c=e.parent.children)==null||c.some(k=>{if(k.checked===1||k.checked===2)return d=2,!0}),e.parent.checked=d}else if(l===1){let d=1;(t=e.parent.children)==null||t.some(k=>{if(k.checked===0||k.checked===2)return d=2,!0}),e.parent.checked=d}else e.parent.checked=2;if(e.parent.checked!==1){const d=a.value.indexOf(e.parent);d>-1&&a.value.splice(d,1)}else n.onlyLeafCheck||a.value.indexOf(e.parent)<=-1&&a.value.push(e.parent);r!==e.parent.checked&&p(e.parent,l)}}return b(),(e,l)=>(i.openBlock(),i.createElementBlock("div",D,[!i.unref(s)||i.unref(s).length<=0?(i.openBlock(),i.createElementBlock("div",O,[i.createElementVNode("span",null,i.toDisplayString(e.emptyTips),1)])):(i.openBlock(!0),i.createElementBlock(i.Fragment,{key:1},i.renderList(i.unref(s),(c,t)=>(i.openBlock(),i.createBlock(i.unref(S.default),{key:c.id?c.id:t,treeNode:c,cascade:e.cascade,showCheckbox:e.showCheckbox,transition:e.transition,showLine:e.showLine,expandAll:e.expandAll,checkedAll:e.checkedAll,multipleCheck:e.multipleCheck,onlyLeafCheck:e.onlyLeafCheck,enableDblclick:e.enableDblclick,enableWholeAnchorStatus:e.enableWholeAnchorStatus,enableCheckConfirm:e.enableCheckConfirm,showId:e.showId,idSeparator:e.idSeparator,hideLeafIcon:e.hideLeafIcon,hideExpander:e.hideExpander,nodeContentClickAction:e.nodeContentClickAction,checkedNodes:a.value,expandKeys:e.expandKeys,onCheckboxClick:E,"onUpdate:expandNode":B,onNodeClick:w,onNodeDblclick:K},{default:i.withCtx(r=>[i.renderSlot(e.$slots,"default",{treeNode:r.treeNode})]),_:2},1032,["treeNode","cascade","showCheckbox","transition","showLine","expandAll","checkedAll","multipleCheck","onlyLeafCheck","enableDblclick","enableWholeAnchorStatus","enableCheckConfirm","showId","idSeparator","hideLeafIcon","hideExpander","nodeContentClickAction","checkedNodes","expandKeys"]))),128))]))}});exports.default=T;
